<!-- app.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Servicios CRUD</title>
  <!-- Agrega aquí tus enlaces a CSS o cualquier otro recurso necesario -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <link rel="stylesheet" type="text/css" href="./mantenimientos.css" th:href="@{/css/index.css}">

</head>
<body>
  <nav id="navbar">
    <a href="#" onclick="cargarpagRep('cargarpagRep')">Repostajes</a>
    <div class="dropdown" onclick="toggleDropdown('repostajesDropdown')">
      <a href="#">Unidades</a>
      <div class="dropdown-content" id="repostajesDropdown">
        <a href="#" onclick="mostrarForm('ver')">Ver</a>
        <a href="#" onclick="mostrarForm('editar')">Editar</a>
        <a href="#" onclick="mostrarForm('crear')">Crear</a>
        <a href="#" onclick="mostrarForm('eliminar')">Eliminar</a>
      </div>
    </div>
    <a href="#" onclick="cargarpagMan('cargarpagMan')">Mantenimientos</a>
    <a href="#" onclick="regresar('regresar')">Regresar</a>
  </nav>
  <div class="mx-auto text-center">
    <h3 class="section-heading logo">UNIDADES </h3>
    <div class="btn-group mt-2"  aria-label="Botones Unidades">
      <button type="button" class="btn btn-primary" onclick="mostrarForm('ver')">Ver</button>
    </div>

    <div class="btn-group mt-2"  aria-label="Botones Unidades">
      <button type="button" class="btn btn-secondary" onclick="mostrarForm('editar')">Editar</button>
    </div>

    <div class="btn-group mt-2"  aria-label="Botones Unidades">
      <button type="button" class="btn btn-success" onclick="mostrarForm('crear')">Crear</button>
    </div>

    <div class="btn-group mt-2"  aria-label="Botones Unidades">
      <button type="button" class="btn btn-danger" onclick="mostrarForm('eliminar')">Eliminar</button>
    </div>

  </div>

  <div id="formContainer">
    <!-- Aquí se mostrarán dinámicamente los formularios -->
  </div>

  <script>
    function regresar() {
      window.location.href = `menu.html`;
    }
    function cargarpagRep() {
      window.location.href = `app.html`;
    }
    function cargarpagMan() {
      window.location.href = `mantenimientos.html`;
    }

    function mostrarForm(tipo) {
      const formContainer = document.getElementById('formContainer');
      formContainer.innerHTML = ''; // Limpiar el contenedor antes de mostrar el nuevo formulario

      switch (tipo) {

        case 'ver':
          formContainer.innerHTML = `
          <div class="container mt-5">
  <div class="mx-auto text-center">
    <h3 class="section-heading logo">BUSCAR UNIDAD POR ID</h3>
  </div>

  <form>
    <div class=" m-2">
      <div class="row">
        <div class="container mb-3">

          <div class="mb-3">
            <label for="verUnidadId">ID de la Unidad:</label>
            <input type="text" id="verUnidadId" class="form-control" placeholder="ID de la Unidad">
          </div>

          <button type="button" class="btn btn-primary" onclick="verUnidad()">Ver</button>

          <div class="datos-usuarios mt-4">
            <p>Placa de la Unidad: <span id="UNIDADES_PLACA"></span></p>
            <p>Número de la Unidad: <span id="NUMERO_UNIDAD"></span></p>
            <p>ID de la Empresa: <span id="ID_EMPRESA"></span></p>
            <p>Correo Electrónico: <span id="CORREO"></span></p>
            <p>Matrícula: <span id="MATRICULA"></span></p>
            <p>Año de la Unidad: <span id="ANIO"></span></p>
          </div>

        </div>
      </div>
    </div>
  </form>
</div>

          `;
          break;


        case 'editar':
          formContainer.innerHTML = `
          <div class="container mt-5">
  <div class="mx-auto text-center">
    <h3 class="section-heading logo">EDITAR UNIDAD</h3>
  </div>

  <form id="editarForm">
    <div class="mb-3">
      <label for="editarUnidadId" aria-label="ID de la unidad que se va a editar">ID de la Unidad:</label>
      <input type="text" id="editarUnidadId" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="UNIDADES_PLACA">UNIDADES_PLACA:</label>
      <input type="text" id="UNIDADES_PLACA" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="NUMERO_UNIDAD">NUMERO_UNIDAD:</label>
      <input type="text" id="NUMERO_UNIDAD" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="ID_EMPRESA">ID_EMPRESA:</label>
      <input type="text" id="ID_EMPRESA" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="CORREO">CORREO:</label>
      <input type="text" id="CORREO" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="COLOR">COLOR:</label>
      <input type="text" id="COLOR" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="MATRICULA">MATRICULA:</label>
      <input type="text" id="MATRICULA" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="ANIO">Año:</label>
      <input type="text" id="ANIO" class="form-control" required>
    </div>

    <button type="button" class="btn btn-primary" onclick="editarUnidad()">Editar Unidad</button>

  </form>
</div>
          `;
          break;


        case 'crear':
          formContainer.innerHTML = `
          <div class="container mt-5">
            <div class="mx-auto text-center">
              <h3 class="section-heading logo">CREAR UNIDAD</h3>
            </div>

  <div class="mb-3">
    <label for="UNIDADES_PLACA" class="form-label">UNIDADES_PLACA</label>
    <input type="text" id="UNIDADES_PLACA" class="form-control" placeholder="UNIDADES_PLACA">
  </div>

  <div class="mb-3">
    <label for="NUMERO_UNIDAD" class="form-label">NUMERO_UNIDAD</label>
    <input type="text" id="NUMERO_UNIDAD" class="form-control" placeholder="NUMERO_UNIDAD">
  </div>

  <div class="mb-3">
    <label for="ID_EMPRESA" class="form-label">ID_EMPRESA</label>
    <input type="text" id="ID_EMPRESA" class="form-control" placeholder="ID_EMPRESA">
  </div>

  <div class="mb-3">
    <label for="CORREO" class="form-label">CORREO</label>
    <input type="text" id="CORREO" class="form-control" placeholder="CORREO">
  </div>

  <div class="mb-3">
    <label for="COLOR" class="form-label">COLOR</label>
    <input type="text" id="COLOR" class="form-control" placeholder="COLOR">
  </div>

  <div class="mb-3">
    <label for="MATRICULA" class="form-label">MATRICULA</label>
    <input type="text" id="MATRICULA" class="form-control" placeholder="MATRICULA">
  </div>

  <div class="mb-3">
    <label for="ANIO" class="form-label">ANIO</label>
    <input type="text" id="ANIO" class="form-control" placeholder="ANIO">
  </div>

  <button type="button" class="btn btn-primary" onclick="crearUnidad()">Crear</button>
</div>

          `;
          break;



        case 'eliminar':
          formContainer.innerHTML = `
          <div class="container mt-5">
  <div class="mx-auto text-center">
    <h3 class="section-heading logo">ELIMINAR UNIDAD</h3>
  </div>

  <form id="eliminarForm">
    <div class="mb-3">
      <label for="eliminarUnidadId" class="form-label">ID de la Unidad:</label>
      <div class="input-group">
        <input type="number" id="eliminarUnidadId" class="form-control small-input" required>
      </div>
    </div>

    <div>
      <button type="button" class="btn btn-primary" onclick="eliminarUnidad()">Eliminar Unidad</button>
    </div>
  </form>
</div>
          `;
          break;
        default:
          console.error('Tipo de formulario no válido');
      }
    }

    async function verUnidad() {

      const unidadesId = document.getElementById('verUnidadId').value;
      const usuario = await axios.get(`http://localhost:3000/unidades/${unidadesId}`);

      // const repostajes = res.data;

      document.getElementById('UNIDADES_PLACA').textContent = usuario.data.UNIDADES_PLACA;
      document.getElementById('NUMERO_UNIDAD').textContent = usuario.data.NUMERO_UNIDAD;
      document.getElementById('ID_EMPRESA').textContent = usuario.data.ID_EMPRESA;
      document.getElementById('CORREO').textContent = usuario.data.CORREO;
      document.getElementById('MATRICULA').textContent = usuario.data.MATRICULA;
      document.getElementById('ANIO').textContent = usuario.data.ANIO;

    }

    

    
    async function cargarListaRepostajes() {
      try {
        const response = await axios.get('http://localhost:3000/repostaje');
        const repostajes = response.data;
        const repostajesUl = document.createElement('ul');

        repostajesUl.innerHTML = ''; // Limpiar la lista antes de agregar nuevos elementos

        repostajes.forEach(repostaje => {
          const li = document.createElement('li');
          li.textContent = `ID: ${repostaje.REPOSTAJE_ID}, Comentario: ${repostaje.REPOSTAJE_COMENTARIO}`;
          repostajesUl.appendChild(li);
        });

        document.getElementById('formContainer').appendChild(repostajesUl);
      } catch (error) {
        console.error('Error al cargar la lista de repostajes:', error);
      }
    }

    async function editarUnidad() {
      try {
        const editarUnidadId = document.getElementById('editarUnidadId').value;

        // Obtén los nuevos datos del formulario
        const UNIDADES_PLACA = document.getElementById('UNIDADES_PLACA').value;
        const NUMERO_UNIDAD = document.getElementById('NUMERO_UNIDAD').value;
        const ID_EMPRESA = document.getElementById('ID_EMPRESA').value;
        const CORREO = document.getElementById('CORREO').value;
        const COLOR = document.getElementById('COLOR').value;
        const MATRICULA = document.getElementById('MATRICULA').value;
        const ANIO = document.getElementById('ANIO').value;

        // Construye el objeto con los nuevos datos, incluyendo el REPOSTAJE_ID
        const nuevosDatos = {
          id: editarUnidadId, // Agregamos el REPOSTAJE_ID
          UNIDADES_PLACA,
          NUMERO_UNIDAD,
          ID_EMPRESA,
          CORREO,
          COLOR,
          MATRICULA,
          ANIO
        };

        // Realiza la solicitud PATCH con la URL completa y los datos en el cuerpo
        console.log('Solicitud PATCH:', `http://localhost:3000/unidades/${editarUnidadId}`, nuevosDatos);
        const response = await axios.patch(`http://localhost:3000/unidades/${editarUnidadId}`, nuevosDatos);

      } catch (error) {
        // Maneja cualquier error de red u otros errores
        console.error('Error al editar la unidad:', error);
      }
    }

    async function crearUnidad() {
    try {
        const UNIDADES_PLACA = document.getElementById('UNIDADES_PLACA').value;
        const NUMERO_UNIDAD = document.getElementById('NUMERO_UNIDAD').value;
        const ID_EMPRESA = document.getElementById('ID_EMPRESA').value;
        const CORREO = document.getElementById('CORREO').value;
        const COLOR = document.getElementById('COLOR').value;
        const MATRICULA = document.getElementById('MATRICULA').value;
        const ANIO = document.getElementById('ANIO').value;

        const unidades = {
          UNIDADES_PLACA,
          NUMERO_UNIDAD,
          ID_EMPRESA,
          CORREO,
          COLOR,
          MATRICULA,
          ANIO
        };

        const res = await axios.post(`http://localhost:3000/unidades/` ,unidades);
        console.log('Unidad creada con éxito',unidades.data);
    } catch (error) {
        console.error('Error al crear la unidad:',  error.response ? error.response.data : error.message);
    }}

    async function eliminarUnidad() {
      const unidadId = document.getElementById('eliminarUnidadId').value;
      // Elimina el repostaje utilizando la función eliminarRepostaje del archivo repostaje.ts
      await axios.delete(`http://localhost:3000/unidades/${unidadId}`);
      // Puedes realizar cualquier acción adicional después de eliminar el repostaje
      console.log('Unidad eliminado con éxito');
    }
  </script>
</body>
</html>
